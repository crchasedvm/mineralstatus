<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Guide to NZ Dairy Cow Nutrition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Harmony -->
    <!-- Application Structure Plan: A tabbed, dashboard-style Single Page Application (SPA). The top-level navigation uses tabs for 'Overview', 'Macrominerals', 'Microminerals', and 'Vitamins'. This structure was chosen for rapid, non-linear access to information, which suits the workflow of a professional (vet, nutritionist) needing to look up specific data quickly. Within each nutrient category, a secondary set of buttons allows selection of individual nutrients. This triggers a dynamic update of a central content area, which includes an interactive Chart.js visualization of NZ reference ranges and collapsible accordion sections for detailed text. This design avoids information overload while keeping critical data (reference ranges) highly visible and interactive, directly addressing the user's need to monitor herd status. -->
    <!-- Visualization & Content Choices: 
        - Report Info: NZ-specific blood/liver reference ranges for each mineral/vitamin. Goal: Inform & Compare. Viz/Method: Horizontal Bar Chart (Chart.js). Interaction: Hover tooltips for precise values. Justification: Visually represents deficient/marginal/adequate ranges for quick assessment. Dynamic updates for a seamless user experience.
        - Report Info: Key mineral antagonisms (K vs Mg; Cu-Mo-S). Goal: Explain Relationships. Viz/Method: HTML/CSS diagram. Interaction: Hover effects to highlight relationships. Justification: Creates a visual centerpiece on the Overview tab to explain complex interactions without using forbidden SVG/Mermaid.
        - Report Info: Detailed text on functions, requirements, deficiency/toxicity. Goal: Organize & Inform. Viz/Method: HTML accordion (<details> tag). Interaction: Click to expand/collapse. Justification: Manages information density, allowing users to drill down into details as needed without cluttering the main view.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8F7F4; color: #333; }
        .tab-active { border-color: #4A5568; color: #2D3748; background-color: #E2E8F0; }
        .nutrient-btn-active { background-color: #38A169; color: white; }
        .chart-container { position: relative; width: 100%; max-width: 700px; margin-left: auto; margin-right: auto; height: 280px; max-height: 350px; }
        @media (min-width: 768px) { .chart-container { height: 320px; } }
        details > summary { list-style: none; cursor: pointer; }
        details > summary::-webkit-details-marker { display: none; }
        details[open] summary .arrow-down { transform: rotate(180deg); }
        .arrow-down { transition: transform 0.2s; }
        .table-header { background-color: #F1F5F9; }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Interactive Guide to Dairy Cow Nutrition</h1>
            <p class="text-md text-gray-600 mt-2">A practical tool for monitoring mineral & vitamin status in New Zealand herds.</p>
        </header>

        <nav class="flex justify-center border-b-2 border-gray-200 mb-8">
            <button data-tab="overview" class="tab-btn py-3 px-6 font-semibold text-gray-600 border-b-4 border-transparent hover:bg-gray-100 focus:outline-none tab-active">Overview</button>
            <button data-tab="macro" class="tab-btn py-3 px-6 font-semibold text-gray-600 border-b-4 border-transparent hover:bg-gray-100 focus:outline-none">Macrominerals</button>
            <button data-tab="micro" class="tab-btn py-3 px-6 font-semibold text-gray-600 border-b-4 border-transparent hover:bg-gray-100 focus:outline-none">Microminerals</button>
            <button data-tab="vitamins" class="tab-btn py-3 px-6 font-semibold text-gray-600 border-b-4 border-transparent hover:bg-gray-100 focus:outline-none">Vitamins</button>
        </nav>

        <main>
            <!-- Overview Content -->
            <div id="overview-content" class="tab-content">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Foundations of Ruminant Nutrition in NZ</h2>
                    <p class="text-gray-700 mb-6">
                        This guide translates complex nutritional science into a practical, interactive format for New Zealand's unique pasture-based dairy systems. While international models provide a foundation, successful herd management here requires a deep understanding of local challenges, particularly the powerful interactions between minerals. High potassium in lush pasture can block magnesium absorption, while molybdenum and sulfur can render dietary copper unavailable. This tool is designed to help you navigate these complexities.
                    </p>

                    <h3 class="text-xl font-bold text-gray-700 mb-4 text-center">Key Mineral Interactions & Antagonisms</h3>
                     <div class="p-4 bg-gray-50 rounded-lg mb-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div class="text-center p-4 rounded-lg bg-red-50 border border-red-200">
                                <h4 class="font-bold text-lg text-red-800">K ➔ Mg</h4>
                                <p class="text-red-700 mt-1">High pasture <b class="font-semibold">Potassium (K)</b> strongly inhibits <b class="font-semibold">Magnesium (Mg)</b> absorption in the rumen, increasing the risk of grass staggers.</p>
                            </div>
                            <div class="text-center p-4 rounded-lg bg-blue-50 border border-blue-200">
                                <h4 class="font-bold text-lg text-blue-800">Mo + S ➔ Cu</h4>
                                <p class="text-blue-700 mt-1"><b class="font-semibold">Molybdenum (Mo)</b> and <b class="font-semibold">Sulfur (S)</b> combine in the rumen to form thiomolybdates, which bind <b class="font-semibold">Copper (Cu)</b>, making it unavailable.</p>
                            </div>
                             <div class="text-center p-4 rounded-lg bg-yellow-50 border border-yellow-200">
                                <h4 class="font-bold text-lg text-yellow-800">Fe ➔ Cu + Mn</h4>
                                <p class="text-yellow-700 mt-1">Excess <b class="font-semibold">Iron (Fe)</b>, often from soil or water, competes with <b class="font-semibold">Copper (Cu)</b> and <b class="font-semibold">Manganese (Mn)</b> for absorption.</p>
                            </div>
                            <div class="text-center p-4 rounded-lg bg-green-50 border border-green-200">
                                <h4 class="font-bold text-lg text-green-800">DCAD Management</h4>
                                <p class="text-green-700 mt-1">A <b class="font-semibold">low DCAD</b> pre-calving is key to preventing <b class="font-semibold">Milk Fever</b> by improving Calcium mobilization. DCAD = (Na⁺ + K⁺) – (Cl⁻ + S²⁻).</p>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold text-gray-700 mb-4 text-center">Herd Status Monitoring at a Glance</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                            <thead class="table-header">
                                <tr>
                                    <th class="py-3 px-4 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Nutrient</th>
                                    <th class="py-3 px-4 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Desired Timing of Evaluation</th>
                                    <th class="py-3 px-4 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Primary Tissue Used</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <!-- Macrominerals -->
                                <tr><td colspan="3" class="py-2 px-4 bg-gray-100 font-bold text-gray-700">Macrominerals</td></tr>
                                <tr>
                                    <td class="py-3 px-4">Calcium (Ca)</td>
                                    <td class="py-3 px-4">Pre-calving / Early Lactation</td>
                                    <td class="py-3 px-4">Serum</td>
                                </tr>
                                <tr>
                                    <td class="py-3 px-4">Phosphorus (P)</td>
                                    <td class="py-3 px-4">Any (esp. with supplementary crops)</td>
                                    <td class="py-3 px-4">Serum</td>
                                </tr>
                                <tr>
                                    <td class="py-3 px-4">Magnesium (Mg)</td>
                                    <td class="py-3 px-4">Pre-calving / Spring</td>
                                    <td class="py-3 px-4">Serum</td>
                                </tr>
                                <!-- Microminerals -->
                                <tr><td colspan="3" class="py-2 px-4 bg-gray-100 font-bold text-gray-700">Microminerals</td></tr>
                                <tr>
                                    <td class="py-3 px-4">Zinc (Zn)</td>
                                    <td class="py-3 px-4">Pre-mating / Autumn (Facial Eczema)</td>
                                    <td class="py-3 px-4">Serum</td>
                                </tr>
                                <tr>
                                    <td class="py-3 px-4">Copper (Cu)</td>
                                    <td class="py-3 px-4">Late Lactation / Pre-dry off</td>
                                    <td class="py-3 px-4"><b>Liver (Gold Standard)</b> / Serum</td>
                                </tr>
                                <tr>
                                    <td class="py-3 px-4">Selenium (Se)</td>
                                    <td class="py-3 px-4">Pre-mating</td>
                                    <td class="py-3 px-4"><b>Whole Blood</b> (long-term) / Serum (recent)</td>
                                </tr>
                                <tr>
                                    <td class="py-3 px-4">Cobalt (as Vit B12)</td>
                                    <td class="py-3 px-4">Pre-mating / Young stock</td>
                                    <td class="py-3 px-4">Serum</td>
                                </tr>
                                <tr>
                                    <td class="py-3 px-4">Iodine (I)</td>
                                    <td class="py-3 px-4">Any (esp. with brassica crops)</td>
                                    <td class="py-3 px-4">Serum (T4) / Plasma (PII)</td>
                                </tr>
                                 <!-- Vitamins -->
                                <tr><td colspan="3" class="py-2 px-4 bg-gray-100 font-bold text-gray-700">Vitamins</td></tr>
                                <tr>
                                    <td class="py-3 px-4">Vitamin A</td>
                                    <td class="py-3 px-4">When feeding stored forages</td>
                                    <td class="py-3 px-4">Plasma</td>
                                </tr>
                                <tr>
                                    <td class="py-3 px-4">Vitamin D</td>
                                    <td class="py-3 px-4">Winter / Housed cattle</td>
                                    <td class="py-3 px-4">Plasma (25-OH-D)</td>
                                </tr>
                                <tr>
                                    <td class="py-3 px-4">Vitamin E</td>
                                    <td class="py-3 px-4">Pre-calving (Transition)</td>
                                    <td class="py-3 px-4">Plasma</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3 class="text-xl font-bold text-gray-700 mt-8 mb-4">How to Use This Guide</h3>
                     <p class="text-gray-700 mb-2">
                        1. <b class="font-semibold">Select a Category:</b> Use the tabs above (Macrominerals, Microminerals, Vitamins) to begin.
                    </p>
                    <p class="text-gray-700 mb-2">
                        2. <b class="font-semibold">Choose a Nutrient:</b> Click on a specific nutrient button to load its data.
                    </p>
                    <p class="text-gray-700 mb-2">
                        3. <b class="font-semibold">Interpret the Chart:</b> The chart displays the NZ diagnostic reference ranges. Hover over the bars to see precise values.
                    </p>
                    <p class="text-gray-700">
                        4. <b class="font-semibold">Explore Details:</b> Click on the accordion sections below the chart for in-depth information on functions, requirements, and deficiency/toxicity signs.
                    </p>
                </div>
            </div>

            <!-- Nutrient Content Area -->
            <div id="nutrient-content-area" class="tab-content hidden">
                <div id="nutrient-buttons" class="flex flex-wrap justify-center gap-2 mb-6"></div>
                
                <div class="bg-white p-6 rounded-lg shadow-md min-h-[600px]">
                    <div id="nutrient-display" class="hidden">
                        <h2 id="nutrient-title" class="text-3xl font-bold text-gray-800 mb-2 text-center"></h2>
                        <p id="nutrient-subtitle" class="text-md text-gray-500 mb-6 text-center"></p>
                        
                        <div class="chart-container mb-8">
                             <canvas id="nutrientChart"></canvas>
                        </div>

                        <div id="nutrient-details" class="space-y-3"></div>
                    </div>
                     <div id="nutrient-placeholder" class="flex flex-col items-center justify-center h-full text-center text-gray-500 pt-16">
                         <svg class="w-16 h-16 mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                        <p class="text-lg font-medium">Please select a nutrient from the buttons above to view its details.</p>
                    </div>
                </div>
            </div>

        </main>
    </div>

<script>
const nutrientData = {
    macro: {
        calcium: {
            title: 'Calcium (Ca)',
            subtitle: 'Essential for bones, muscle function, and nerve transmission.',
            chartData: {
                labels: ['Deficient', 'Marginal (Subclinical)', 'Adequate'],
                values: [2.00, 2.25, 2.5], 
                unit: 'mmol/L',
                ranges: ['< 2.00', '2.00 - 2.25', '> 2.25']
            },
            details: [
                { title: 'Physiological Functions', content: 'Calcium is the most abundant mineral in the body, with 98% stored in the skeleton providing structural integrity. The remaining 2% in extracellular fluids and soft tissues is vital for life. It is essential for: <br><b>• Muscle Contraction:</b> Triggers the interaction of actin and myosin in both skeletal and smooth muscle. <br><b>• Nerve Transmission:</b> Required for the release of neurotransmitters at the synapse. <br><b>• Blood Clotting:</b> Acts as a cofactor for several key enzymes in the coagulation cascade. <br><b>• Cellular Signaling:</b> Functions as a universal second messenger, relaying signals from the cell surface to intracellular proteins to regulate a vast array of cellular processes. <br>Blood calcium is tightly regulated by parathyroid hormone (PTH) and Vitamin D, which control its absorption from the intestine, reabsorption from the kidney, and mobilization from bone.' },
                { title: 'Suggested Dietary Intake (NZ Context)', content: 'For lactating cows, a dietary concentration of <b>0.45% to 0.60% DM</b> is typical. However, the most critical factor in NZ is not the dietary concentration itself, but managing the <b>Dietary Cation-Anion Difference (DCAD)</b> in the pre-calving diet to prevent milk fever. This involves feeding a low DCAD diet for 3 weeks pre-calving to improve calcium mobilization.' },
                { title: 'Deficiency & Toxicity', content: '<b>Deficiency:</b> Periparturient hypocalcemia (milk fever) is the major disorder, with clinical and subclinical forms increasing risk for other diseases. Chronic deficiency can cause osteoporosis. <br><b>Toxicity:</b> Rare, but high intake can interfere with P and Mg absorption.' }
            ]
        },
        phosphorus: {
            title: 'Phosphorus (P)',
            subtitle: 'Critical for energy metabolism (ATP), DNA, and bone structure.',
            chartData: {
                labels: ['Severely Deficient', 'Marginal/Deficient', 'Adequate'],
                values: [0.65, 1.1, 2.0],
                unit: 'mmol/L',
                ranges: ['< 0.65', '0.65 - 1.1', '1.3 - 2.0']
            },
            details: [
                { title: 'Physiological Functions', content: 'Phosphorus, as phosphate, is involved in more biological functions than any other mineral. Key roles include: <br><b>• Energy Metabolism:</b> It is a core component of adenosine triphosphate (ATP), the universal energy currency of the cell. The breaking of high-energy phosphate bonds in ATP releases the energy that drives most metabolic reactions. <br><b>• Cell Structure:</b> It forms the hydrophilic backbone of phospholipids, which are the primary building blocks of all biological membranes. <br><b>• Genetic Material:</b> It forms the phosphodiester bonds that link nucleotides together to create the structure of DNA and RNA. <br><b>• Acid-Base Balance:</b> It is a major component of the phosphate buffer system in blood, helping to maintain stable pH. <br><b>• Bone Structure:</b> Approximately 80% of body phosphorus is found in the skeleton, complexed with calcium as hydroxyapatite.' },
                { title: 'Suggested Dietary Intake (NZ Context)', content: 'A dietary concentration of <b>0.32% to 0.42% of DM</b> is generally recommended for lactating cows. Particular attention is needed when feeding supplementary crops like fodder beet, which are very low in phosphorus and require specific supplementation to avoid production losses.' },
                { title: 'Deficiency & Toxicity', content: '<b>Deficiency:</b> Reduced feed intake, poor growth, and pica (depraved appetite). Severe deficiency causes rickets or osteomalacia. <br><b>Toxicity:</b> High intake in pre-fresh cows can suppress Vitamin D activation, increasing milk fever risk.' }
            ]
        },
        magnesium: {
            title: 'Magnesium (Mg)',
            subtitle: 'Vital for enzyme activation and preventing grass staggers.',
            chartData: {
                labels: ['Deficient (Risk of Tetany)', 'Marginal (Subclinical)', 'Adequate'],
                values: [0.50, 0.80, 1.0],
                unit: 'mmol/L',
                ranges: ['< 0.50', '0.50 - 0.80', '> 0.80']
            },
            details: [
                { title: 'Physiological Functions', content: 'Magnesium is a critical cofactor for over 300 enzymes, making it essential for a vast range of metabolic processes. Its functions include: <br><b>• Enzyme Activation:</b> It is required by nearly all enzymes that utilize ATP, such as kinases involved in glycolysis and the Krebs cycle. It stabilizes the ATP molecule, allowing it to be used effectively. <br><b>• Calcium Homeostasis:</b> Mg is absolutely essential for the cow\'s ability to respond to low blood calcium. It is required for both the secretion of parathyroid hormone (PTH) from the parathyroid gland and for the binding of PTH to its receptors in bone and kidney. Therefore, hypomagnesaemia directly causes hypocalcemia. <br><b>• Nerve & Muscle Function:</b> It is crucial for normal nerve conduction and muscle relaxation, acting as a natural calcium channel blocker at the neuromuscular junction.' },
                { title: 'Suggested Dietary Intake (NZ Context)', content: 'Due to the potassium antagonism, much higher dietary levels are needed. DairyNZ recommends target concentrations of <b>0.35% DM for dry cows</b> and <b>0.28% DM for lactating cows</b>. This often requires supplementing <b>15-20 grams of elemental Mg per cow per day</b> during the high-risk spring period.' },
                { title: 'Deficiency & Toxicity', content: '<b>Deficiency:</b> Hypomagnesaemia (grass tetany) is an acute, often fatal disorder causing nervousness, tremors, convulsions, and death. Subclinical deficiency increases milk fever risk. <br><b>Toxicity:</b> Extremely rare from dietary sources.' }
            ]
        },
    },
    micro: {
        zinc: {
            title: 'Zinc (Zn)',
            subtitle: 'Crucial for enzymes, immune function, and hoof/skin integrity.',
            chartData: {
                labels: ['Deficient', 'Marginal', 'Adequate'],
                values: [7, 12, 18.5],
                unit: 'µmol/L (Serum)',
                ranges: ['< 7', '7 - 12', '12 - 18.5']
            },
            details: [
                { title: 'Physiological Functions', content: 'Zinc is a component of over 300 enzymes, participating in all major metabolic pathways. Its key functions are: <br><b>• Catalytic Role:</b> It is a structural or catalytic component of enzymes like carbonic anhydrase (for CO2 transport), alcohol dehydrogenase, and alkaline phosphatase. <br><b>• Gene Expression:</b> It is a key structural component of "zinc-finger" proteins, which are transcription factors that bind to DNA and regulate the expression of genes. <br><b>• Immune Function:</b> Zinc is essential for the normal development and function of both the innate and adaptive immune systems, including the function of neutrophils, macrophages, and lymphocytes. <br><b>• Epithelial Integrity:</b> It is critical for maintaining the health and integrity of skin and hooves through its role in cell division and protein synthesis.' },
                { title: 'Suggested Dietary Intake (NZ Context)', content: 'A daily intake of <b>750 mg of zinc per cow</b> is recommended for general health. During the facial eczema risk period (autumn), much higher doses are used for prevention, which requires careful management to avoid inducing a secondary copper deficiency.' },
                { title: 'Deficiency & Toxicity', content: '<b>Deficiency:</b> Reduced feed intake, parakeratosis (thick, crusty skin), poor hoof quality, and impaired immune function. <br><b>Toxicity:</b> Relatively non-toxic, but very high levels can induce copper deficiency.' }
            ]
        },
        copper: {
            title: 'Copper (Cu)',
            subtitle: 'For growth, immunity, and fertility. Status assessed by liver biopsy.',
            chartData: {
                labels: ['Deficient', 'Marginal', 'Adequate', 'Toxicity Risk'],
                values: [0.045, 0.095, 2.8, 3.0],
                unit: 'mmol/kg (Liver)',
                ranges: ['< 0.045', '0.045 - 0.095', '> 0.095', '> 2.800']
            },
            details: [
                { title: 'Physiological Functions', content: 'Copper is an essential cofactor for several critical oxidoreductase enzymes (cuproenzymes). Key functions include: <br><b>• Iron Metabolism:</b> It is a component of ceruloplasmin, an enzyme that oxidizes ferrous iron (Fe2+) to ferric iron (Fe3+), which is required for iron to be transported in the blood by transferrin. A copper deficiency can therefore cause a secondary iron-deficiency anemia. <br><b>• Connective Tissue:</b> It is required for lysyl oxidase, an enzyme essential for the cross-linking of collagen and elastin, which provides strength and elasticity to connective tissues, bone, and blood vessels. <br><b>• Pigmentation:</b> It is a component of tyrosinase, the enzyme required for the synthesis of melanin, the pigment in hair and skin. <br><b>• Antioxidant Defense:</b> It is a component of Cu/Zn superoxide dismutase (SOD), an enzyme that neutralizes superoxide free radicals.' },
                { title: 'Suggested Dietary Intake (NZ Context)', content: 'Dietary requirements are dictated by the need to overcome antagonists. Total dietary copper levels may need to be <b>20 ppm or higher</b>. DairyNZ provides a general recommendation of <b>250-400 mg of total copper per cow per day</b>. Supplementation must be guided by liver biopsy results to avoid toxicity.' },
                { title: 'Deficiency & Toxicity', content: '<b>Deficiency:</b> Poor growth, scours, reduced fertility, and loss of coat color ("spectacles"). <br><b>Toxicity:</b> Chronic toxicity is a growing problem. Excess Cu accumulates in the liver and a stress event can trigger a fatal hemolytic crisis.' }
            ]
        },
        selenium: {
            title: 'Selenium (Se)',
            subtitle: 'Key antioxidant and immune function modulator.',
            chartData: {
                labels: ['Deficient', 'Marginal', 'Adequate', 'Excessive'],
                values: [130, 250, 3000, 3200],
                unit: 'nmol/L (Whole Blood)',
                ranges: ['< 130', '130 - 250', '> 250', '> 3000']
            },
            details: [
                { title: 'Physiological Functions', content: 'Selenium functions as the amino acid selenocysteine within a family of selenoproteins. Its most important roles are: <br><b>• Antioxidant Defense:</b> It is the active center of the enzyme glutathione peroxidase (GPx), which neutralizes hydrogen peroxide and other damaging free radicals, protecting cell membranes from oxidative damage. It works synergistically with Vitamin E. <br><b>• Thyroid Hormone Metabolism:</b> It is a component of the deiodinase enzymes, which are responsible for converting the thyroid hormone thyroxine (T4) into its more biologically active form, triiodothyronine (T3). This links selenium directly to the regulation of the body\'s metabolic rate. <br><b>• Immune Function:</b> Adequate selenium is critical for a robust immune response, particularly for neutrophil function and reducing the incidence of retained fetal membranes and mastitis.' },
                { title: 'Suggested Dietary Intake (NZ Context)', content: 'Due to widespread soil deficiency, supplementation is routine. A dietary concentration of <b>0.3 mg/kg of total DM</b> is considered adequate. DairyNZ recommends a total daily intake of <b>5 mg of selenium per cow</b>. It has a narrow margin of safety.' },
                { title: 'Deficiency & Toxicity', content: '<b>Deficiency:</b> White muscle disease in calves, retained fetal membranes, increased mastitis, and ill-thrift. <br><b>Toxicity:</b> Has a narrow margin of safety. Chronic toxicity causes hair loss and hoof deformities.' }
            ]
        },
        cobalt: {
            title: 'Cobalt (Co)',
            subtitle: 'Required by rumen microbes to synthesize Vitamin B12.',
            chartData: {
                labels: ['Deficient', 'Marginal', 'Adequate'],
                values: [75, 220, 250],
                unit: 'pmol/L (Serum B12)',
                ranges: ['< 75', '75 - 220', '> 220']
            },
            details: [
                { title: 'Physiological Functions', content: 'Cobalt\'s sole function in ruminants is as a central component of the vitamin B12 (cobalamin) molecule, which is synthesized by rumen microbes. The animal has no direct requirement for cobalt itself. Vitamin B12 is a critical cofactor for two key enzymes: <br><b>• Methylmalonyl-CoA Mutase:</b> This enzyme is essential for the final step in the conversion of propionate (a major VFA from rumen fermentation) into glucose in the liver. A deficiency of B12 blocks this pathway, leading to severe energy deficiency. <br><b>• Methionine Synthase:</b> This enzyme is involved in the regeneration of the amino acid methionine, which is important for protein synthesis and metabolism.' },
                { title: 'Suggested Dietary Intake (NZ Context)', content: 'The NRC (2001) requirement is <b>0.11 ppm of diet DM</b>. However, research suggests high-producing cows may benefit from higher levels (1.0-1.3 ppm). DairyNZ recommends a daily intake of <b>8-10 mg of cobalt per cow</b>.' },
                { title: 'Deficiency & Toxicity', content: '<b>Deficiency:</b> Loss of appetite, ill-thrift, poor growth, severe weight loss, and anemia. Young, growing animals are most susceptible. <br><b>Toxicity:</b> Not a practical concern.' }
            ]
        },
        iodine: {
            title: 'Iodine (I)',
            subtitle: 'Essential for thyroid hormones and metabolic rate.',
            chartData: {
                labels: ['Deficient', 'Marginal', 'Adequate'],
                values: [20, 35, 80],
                unit: 'nmol/L (Serum T4)',
                ranges: ['< 20', '20 - 35', '> 35']
            },
            details: [
                { title: 'Physiological Functions', content: 'Iodine\'s only known function is as an essential constituent of the thyroid hormones, thyroxine (T4) and triiodothyronine (T3). These hormones are synthesized in the thyroid gland and are the primary regulators of the body\'s basal metabolic rate. They act on virtually all cells in the body to control the rate of oxygen consumption and energy expenditure, thereby influencing growth, thermoregulation, and the metabolism of carbohydrates, proteins, and fats. Adequate iodine is therefore essential for normal growth, lactation, and reproduction.' },
                { title: 'Suggested Dietary Intake (NZ Context)', content: 'A daily intake of <b>50-60 mg of iodine per cow</b> is recommended. The requirement is increased when feeding goitrogenic crops like brassicas, which are common in NZ and interfere with iodine uptake by the thyroid gland.' },
                { title: 'Deficiency & Toxicity', content: '<b>Deficiency:</b> Goiter (enlarged thyroid), especially in newborn calves. In adults, causes reduced fertility and poor production. <br><b>Toxicity:</b> Narrow safety margin. Excess can cause coughing, nasal discharge, and paradoxically, goiter.' }
            ]
        }
    },
    vitamins: {
        vitaminA: {
            title: 'Vitamin A (Retinol)',
            subtitle: 'For vision, epithelial health, and immunity.',
            chartData: {
                labels: ['Deficient', 'Marginal', 'Adequate'],
                values: [0.2, 0.3, 0.4],
                unit: 'µg/mL (Plasma)',
                ranges: ['< 0.2', '0.2 - 0.3', '> 0.3']
            },
            details: [
                { title: 'Physiological Functions', content: 'Vitamin A (retinol and its derivatives) is a fat-soluble vitamin with several critical functions: <br><b>• Vision:</b> The aldehyde form, retinal, is a key component of the visual pigment rhodopsin in the retina, making it essential for vision, especially in low light. <br><b>• Epithelial Integrity:</b> The acid form, retinoic acid, is essential for the differentiation and maintenance of epithelial tissues that line the respiratory, gastrointestinal, and reproductive tracts. It ensures these tissues produce mucus and form an effective barrier against pathogens. <br><b>• Immune Function:</b> It is vital for both the innate and adaptive immune systems, influencing the function of neutrophils, macrophages, and lymphocytes. <br><b>• Reproduction:</b> Adequate Vitamin A is required for normal reproductive function in both males and females.' },
                { title: 'Suggested Dietary Intake (NZ Context)', content: 'The recommended intake is <b>110 IU per kg of body weight</b>, which equates to approximately <b>70,000 IU/day</b> for a typical Holstein. Supplementation is critical when feeding stored forages (silage, hay) or high-concentrate diets, as Vitamin A content degrades over time.' },
                { title: 'Deficiency', content: 'Night blindness, reproductive failure, and increased susceptibility to infections due to compromised epithelial barriers.' }
            ]
        },
        vitaminD: {
            title: 'Vitamin D',
            subtitle: 'For calcium balance and immune modulation.',
            chartData: {
                labels: ['Suboptimal', 'Sufficient'],
                values: [30, 40],
                unit: 'ng/mL (Plasma 25-OH-D)',
                ranges: ['< 30', '> 30']
            },
            details: [
                { title: 'Physiological Functions', content: 'Vitamin D is a prohormone that is converted to its active hormonal form, 1,25-dihydroxyvitamin D. Its functions include: <br><b>• Calcium & Phosphorus Homeostasis:</b> This is its classical function. The active hormone binds to the Vitamin D Receptor (VDR) in the intestine to increase the absorption of dietary calcium and phosphorus. It also works with PTH to regulate bone resorption and kidney reabsorption of these minerals. <br><b>• Immune Modulation:</b> The VDR is present on immune cells (macrophages, T-cells, B-cells). Vitamin D plays a critical role in modulating the immune system, for example, by enhancing the production of antimicrobial peptides by macrophages, which helps them kill pathogens.' },
                { title: 'Suggested Dietary Intake (NZ Context)', content: 'An intake of <b>30 IU per kg of body weight</b> (approx. 20,000 IU/day) is sufficient for calcium metabolism. However, to optimize immune function, higher levels of <b>45-50 IU/kg of body weight</b> (approx. 30,000 IU/day) may be beneficial, especially for cows with limited sun exposure.' },
                { title: 'Deficiency', content: 'Severe deficiency causes rickets (young) or osteomalacia (adults). Suboptimal status is linked to impaired immune function.' }
            ]
        },
        vitaminE: {
            title: 'Vitamin E (α-Tocopherol)',
            subtitle: 'The primary lipid-soluble antioxidant.',
            chartData: {
                labels: ['Deficient', 'Marginal', 'Adequate'],
                values: [2.0, 3.0, 4.0],
                unit: 'µg/mL (Plasma)',
                ranges: ['< 2.0', '2.0 - 3.0', '> 3.0']
            },
            details: [
                { title: 'Physiological Functions', content: 'Vitamin E (primarily α-tocopherol) is the most important lipid-soluble, chain-breaking antioxidant in the body. Its key function is: <br><b>• Membrane Protection:</b> It is located within cell membranes, where it directly neutralizes free radicals, thereby protecting the polyunsaturated fatty acids in the membrane from oxidative damage (lipid peroxidation). This maintains the structural integrity and function of all cells, but is particularly critical for: <br>  - <b>Immune Cells:</b> Neutrophils and macrophages produce a burst of free radicals to kill ingested bacteria. Vitamin E protects these immune cells from self-inflicted oxidative damage, preserving their function. <br>  - <b>Muscle Cells:</b> Protects muscle tissue from oxidative damage during exercise and metabolic stress.' },
                { title: 'Suggested Dietary Intake (NZ Context)', content: 'Basal requirements are <b>500 IU/day for lactating cows</b> and <b>1,000 IU/day for dry cows</b>. However, for enhanced immunity, strategic supplementation of <b>2,000 IU/day during the final 2-3 weeks of gestation</b> is an evidence-based strategy to reduce metabolic diseases.' },
                { title: 'Deficiency', content: 'Can cause white muscle disease (nutritional muscular dystrophy), especially if Selenium is also low. Suboptimal levels compromise immune function during the high-stress transition period.' }
            ]
        }
    }
};

let currentChart = null;

document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    const nutrientButtonsContainer = document.getElementById('nutrient-buttons');
    const nutrientDisplay = document.getElementById('nutrient-display');
    const nutrientPlaceholder = document.getElementById('nutrient-placeholder');

    function showTab(tabId) {
        tabContents.forEach(content => {
            if (content.id === `${tabId}-content` || (tabId !== 'overview' && content.id === 'nutrient-content-area')) {
                content.classList.remove('hidden');
            } else {
                content.classList.add('hidden');
            }
        });

        tabs.forEach(tab => {
            if (tab.dataset.tab === tabId) {
                tab.classList.add('tab-active');
            } else {
                tab.classList.remove('tab-active');
            }
        });
        
        nutrientDisplay.classList.add('hidden');
        nutrientPlaceholder.classList.remove('hidden');
        updateNutrientButtons(tabId);
    }
    
    function updateNutrientButtons(tabId) {
        nutrientButtonsContainer.innerHTML = '';
        if (tabId === 'overview') return;

        const nutrientCategory = nutrientData[tabId];
        Object.keys(nutrientCategory).forEach(key => {
            const nutrient = nutrientCategory[key];
            const button = document.createElement('button');
            button.className = 'nutrient-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors';
            button.textContent = nutrient.title;
            button.dataset.nutrientKey = key;
            button.dataset.category = tabId;
            nutrientButtonsContainer.appendChild(button);
        });
    }

    tabs.forEach(tab => {
        tab.addEventListener('click', () => showTab(tab.dataset.tab));
    });

    nutrientButtonsContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('nutrient-btn')) {
            const key = e.target.dataset.nutrientKey;
            const category = e.target.dataset.category;
            displayNutrient(category, key);

            document.querySelectorAll('.nutrient-btn').forEach(btn => btn.classList.remove('nutrient-btn-active'));
            e.target.classList.add('nutrient-btn-active');
        }
    });

    function displayNutrient(category, key) {
        const nutrient = nutrientData[category][key];
        if (!nutrient) return;

        nutrientPlaceholder.classList.add('hidden');
        nutrientDisplay.classList.remove('hidden');

        document.getElementById('nutrient-title').textContent = nutrient.title;
        document.getElementById('nutrient-subtitle').textContent = nutrient.subtitle;

        const detailsContainer = document.getElementById('nutrient-details');
        detailsContainer.innerHTML = '';
        nutrient.details.forEach(detail => {
            const detailElement = document.createElement('details');
            detailElement.className = 'bg-gray-50 rounded-lg border border-gray-200';
            detailElement.innerHTML = `
                <summary class="flex justify-between items-center p-4 font-semibold text-gray-700">
                    <span>${detail.title}</span>
                    <span class="arrow-down">
                        <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </span>
                </summary>
                <div class="p-4 pt-0 text-gray-600">
                    ${detail.content}
                </div>
            `;
            detailsContainer.appendChild(detailElement);
        });

        renderChart(nutrient.chartData);
    }

    function renderChart(chartData) {
        const ctx = document.getElementById('nutrientChart').getContext('2d');
        const colors = {
            deficient: 'rgba(239, 68, 68, 0.7)', // red
            marginal: 'rgba(245, 158, 11, 0.7)', // amber
            adequate: 'rgba(16, 185, 129, 0.7)', // emerald
            excessive: 'rgba(147, 51, 234, 0.7)', // purple
            toxicity: 'rgba(127, 29, 29, 0.7)' // dark red
        };
        
        const backgroundColors = chartData.labels.map(label => {
            if (label.toLowerCase().includes('deficient')) return colors.deficient;
            if (label.toLowerCase().includes('marginal')) return colors.marginal;
            if (label.toLowerCase().includes('adequate') || label.toLowerCase().includes('sufficient')) return colors.adequate;
            if (label.toLowerCase().includes('excessive')) return colors.excessive;
            if (label.toLowerCase().includes('toxicity')) return colors.toxicity;
            return 'rgba(156, 163, 175, 0.7)';
        });
        
        if (currentChart) {
            currentChart.destroy();
        }

        currentChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: chartData.labels,
                datasets: [{
                    label: `Reference Range (${chartData.unit})`,
                    data: chartData.values,
                    backgroundColor: backgroundColors,
                    borderColor: backgroundColors.map(c => c.replace('0.7', '1')),
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: `Concentration (${chartData.unit})`,
                            font: { size: 14 }
                        }
                    },
                    y: {
                        ticks: {
                            font: { size: 12 }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const range = chartData.ranges[context.dataIndex];
                                return `Status: ${context.label} | Range: ${range} ${chartData.unit}`;
                            }
                        }
                    }
                }
            }
        });
    }

    showTab('overview');
});
</script>

</body>
</html>
