<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Guide to NZ Dairy Cow Nutrition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Harmony -->
    <!-- Application Structure Plan: A tabbed, dashboard-style Single Page Application (SPA). The top-level navigation uses tabs for 'Overview', 'Macrominerals', 'Microminerals', and 'Vitamins'. This structure was chosen for rapid, non-linear access to information, which suits the workflow of a professional (vet, nutritionist) needing to look up specific data quickly. Within each nutrient category, a secondary set of buttons allows selection of individual nutrients. This triggers a dynamic update of a central content area, which includes an interactive Chart.js visualization of NZ reference ranges and collapsible accordion sections for detailed text. This design avoids information overload while keeping critical data (reference ranges) highly visible and interactive, directly addressing the user's need to monitor herd status. -->
    <!-- Visualization & Content Choices: 
        - Report Info: NZ-specific blood/liver reference ranges for each mineral/vitamin. Goal: Inform & Compare. Viz/Method: Horizontal Bar Chart (Chart.js). Interaction: Hover tooltips for precise values. Justification: Visually represents deficient/marginal/adequate ranges for quick assessment. Dynamic updates for a seamless user experience.
        - Report Info: Key mineral antagonisms (K vs Mg; Cu-Mo-S). Goal: Explain Relationships. Viz/Method: HTML/CSS diagram. Interaction: Hover effects to highlight relationships. Justification: Creates a visual centerpiece on the Overview tab to explain complex interactions without using forbidden SVG/Mermaid.
        - Report Info: Detailed text on functions, requirements, deficiency/toxicity. Goal: Organize & Inform. Viz/Method: HTML accordion (<details> tag). Interaction: Click to expand/collapse. Justification: Manages information density, allowing users to drill down into details as needed without cluttering the main view.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8F7F4; color: #333; }
        .tab-active { border-color: #4A5568; color: #2D3748; background-color: #E2E8F0; }
        .nutrient-btn-active { background-color: #38A169; color: white; }
        .chart-container { position: relative; width: 100%; max-width: 700px; margin-left: auto; margin-right: auto; height: 280px; max-height: 350px; }
        @media (min-width: 768px) { .chart-container { height: 320px; } }
        details > summary { list-style: none; cursor: pointer; }
        details > summary::-webkit-details-marker { display: none; }
        details[open] summary .arrow-down { transform: rotate(180deg); }
        .arrow-down { transition: transform 0.2s; }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Interactive Guide to Dairy Cow Nutrition</h1>
            <p class="text-md text-gray-600 mt-2">A practical tool for monitoring mineral & vitamin status in New Zealand herds.</p>
        </header>

        <nav class="flex justify-center border-b-2 border-gray-200 mb-8">
            <button data-tab="overview" class="tab-btn py-3 px-6 font-semibold text-gray-600 border-b-4 border-transparent hover:bg-gray-100 focus:outline-none tab-active">Overview</button>
            <button data-tab="macro" class="tab-btn py-3 px-6 font-semibold text-gray-600 border-b-4 border-transparent hover:bg-gray-100 focus:outline-none">Macrominerals</button>
            <button data-tab="micro" class="tab-btn py-3 px-6 font-semibold text-gray-600 border-b-4 border-transparent hover:bg-gray-100 focus:outline-none">Microminerals</button>
            <button data-tab="vitamins" class="tab-btn py-3 px-6 font-semibold text-gray-600 border-b-4 border-transparent hover:bg-gray-100 focus:outline-none">Vitamins</button>
        </nav>

        <main>
            <!-- Overview Content -->
            <div id="overview-content" class="tab-content">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Foundations of Ruminant Nutrition in NZ</h2>
                    <p class="text-gray-700 mb-6">
                        This guide translates complex nutritional science into a practical, interactive format for New Zealand's unique pasture-based dairy systems. While international models provide a foundation, successful herd management here requires a deep understanding of local challenges, particularly the powerful interactions between minerals. High potassium in lush pasture can block magnesium absorption, while molybdenum and sulfur can render dietary copper unavailable. This tool is designed to help you navigate these complexities.
                    </p>

                    <h3 class="text-xl font-bold text-gray-700 mb-4 text-center">Key Mineral Interactions & Antagonisms</h3>
                     <div class="p-4 bg-gray-50 rounded-lg">
                        <div class="flex flex-col md:flex-row justify-around items-center gap-8">
                            <div class="text-center p-4 rounded-lg bg-red-50 border border-red-200">
                                <h4 class="font-bold text-lg text-red-800">K ➔ Mg</h4>
                                <p class="text-red-700 mt-1">High pasture <b class="font-semibold">Potassium (K)</b> strongly inhibits <b class="font-semibold">Magnesium (Mg)</b> absorption in the rumen, increasing the risk of grass staggers (hypomagnesaemia).</p>
                            </div>
                            <div class="text-center p-4 rounded-lg bg-blue-50 border border-blue-200">
                                <h4 class="font-bold text-lg text-blue-800">Mo + S ➔ Cu</h4>
                                <p class="text-blue-700 mt-1"><b class="font-semibold">Molybdenum (Mo)</b> and <b class="font-semibold">Sulfur (S)</b> combine in the rumen to form thiomolybdates, which bind <b class="font-semibold">Copper (Cu)</b>, making it unavailable for absorption.</p>
                            </div>
                             <div class="text-center p-4 rounded-lg bg-yellow-50 border border-yellow-200">
                                <h4 class="font-bold text-lg text-yellow-800">Fe ➔ Cu + Mn</h4>
                                <p class="text-yellow-700 mt-1">Excess <b class="font-semibold">Iron (Fe)</b>, often from soil or water, competes with <b class="font-semibold">Copper (Cu)</b> and <b class="font-semibold">Manganese (Mn)</b> for absorption.</p>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold text-gray-700 mt-8 mb-4">How to Use This Guide</h3>
                     <p class="text-gray-700 mb-2">
                        1. <b class="font-semibold">Select a Category:</b> Use the tabs above (Macrominerals, Microminerals, Vitamins) to begin.
                    </p>
                    <p class="text-gray-700 mb-2">
                        2. <b class="font-semibold">Choose a Nutrient:</b> Click on a specific nutrient button to load its data.
                    </p>
                    <p class="text-gray-700 mb-2">
                        3. <b class="font-semibold">Interpret the Chart:</b> The chart displays the NZ diagnostic reference ranges. Hover over the bars to see precise values.
                    </p>
                    <p class="text-gray-700">
                        4. <b class="font-semibold">Explore Details:</b> Click on the accordion sections below the chart for in-depth information on functions, requirements, and deficiency/toxicity signs.
                    </p>
                </div>
            </div>

            <!-- Nutrient Content Area -->
            <div id="nutrient-content-area" class="tab-content hidden">
                <div id="nutrient-buttons" class="flex flex-wrap justify-center gap-2 mb-6"></div>
                
                <div class="bg-white p-6 rounded-lg shadow-md min-h-[600px]">
                    <div id="nutrient-display" class="hidden">
                        <h2 id="nutrient-title" class="text-3xl font-bold text-gray-800 mb-2 text-center"></h2>
                        <p id="nutrient-subtitle" class="text-md text-gray-500 mb-6 text-center"></p>
                        
                        <div class="chart-container mb-8">
                             <canvas id="nutrientChart"></canvas>
                        </div>

                        <div id="nutrient-details" class="space-y-3"></div>
                    </div>
                     <div id="nutrient-placeholder" class="flex flex-col items-center justify-center h-full text-center text-gray-500 pt-16">
                         <svg class="w-16 h-16 mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                        <p class="text-lg font-medium">Please select a nutrient from the buttons above to view its details.</p>
                    </div>
                </div>
            </div>

        </main>
    </div>

<script>
const nutrientData = {
    macro: {
        calcium: {
            title: 'Calcium (Ca)',
            subtitle: 'Essential for bones, muscle function, and nerve transmission.',
            chartData: {
                labels: ['Deficient', 'Marginal (Subclinical)', 'Adequate'],
                values: [2.00, 2.25, 2.5], 
                unit: 'mmol/L',
                ranges: ['< 2.00', '2.00 - 2.25', '> 2.25']
            },
            details: [
                { title: 'Key NZ Context & Challenge', content: 'The primary challenge is not dietary lack, but impaired mobilization at calving due to high potassium (high DCAD) in lush pasture, leading to milk fever (hypocalcemia). Management of the pre-calving diet is critical.' },
                { title: 'Physiological Functions', content: '98% is in the skeleton. The rest is vital for muscle contraction, nerve impulse transmission, blood clotting, and as a cellular second messenger. Blood levels are tightly regulated by PTH and Vitamin D.' },
                { title: 'Deficiency & Toxicity', content: '<b>Deficiency:</b> Periparturient hypocalcemia (milk fever) is the major disorder, with clinical and subclinical forms increasing risk for other diseases. Chronic deficiency can cause osteoporosis. <br><b>Toxicity:</b> Rare, but high intake can interfere with P and Mg absorption.' }
            ]
        },
        phosphorus: {
            title: 'Phosphorus (P)',
            subtitle: 'Critical for energy metabolism (ATP), DNA, and bone structure.',
            chartData: {
                labels: ['Severely Deficient', 'Marginal/Deficient', 'Adequate'],
                values: [0.65, 1.1, 2.0],
                unit: 'mmol/L',
                ranges: ['< 0.65', '0.65 - 1.1', '1.3 - 2.0']
            },
            details: [
                { title: 'Key NZ Context & Challenge', content: 'Pasture can be marginally deficient. Supplementary crops like fodder beet are very low in phosphorus, requiring specific supplementation to avoid production losses and metabolic issues.' },
                { title: 'Physiological Functions', content: 'A core component of ATP (energy), phospholipids (cell membranes), and nucleic acids (DNA/RNA). 80% is in the skeleton with calcium. Crucial for acid-base balance.' },
                { title: 'Deficiency & Toxicity', content: '<b>Deficiency:</b> Reduced feed intake, poor growth, and pica (depraved appetite). Severe deficiency causes rickets or osteomalacia. <br><b>Toxicity:</b> High intake in pre-fresh cows can suppress Vitamin D activation, increasing milk fever risk.' }
            ]
        },
        magnesium: {
            title: 'Magnesium (Mg)',
            subtitle: 'Vital for enzyme activation and preventing grass staggers.',
            chartData: {
                labels: ['Deficient (Risk of Tetany)', 'Marginal (Subclinical)', 'Adequate'],
                values: [0.50, 0.80, 1.0],
                unit: 'mmol/L',
                ranges: ['< 0.50', '0.50 - 0.80', '> 0.80']
            },
            details: [
                { title: 'Key NZ Context & Challenge', content: 'Hypomagnesaemia (grass staggers) is a major issue. High potassium in spring pasture directly blocks Mg absorption in the rumen. Standard NRC requirements are inadequate; much higher dietary levels are needed to overcome this antagonism.' },
                { title: 'Physiological Functions', content: 'Cofactor for over 300 enzymes, essential for ATP metabolism and nerve/muscle function. Critically, Mg is required for PTH secretion and action, linking it directly to calcium homeostasis.' },
                { title: 'Deficiency & Toxicity', content: '<b>Deficiency:</b> Hypomagnesaemia (grass tetany) is an acute, often fatal disorder causing nervousness, tremors, convulsions, and death. Subclinical deficiency increases milk fever risk. <br><b>Toxicity:</b> Extremely rare from dietary sources.' }
            ]
        },
    },
    micro: {
        zinc: {
            title: 'Zinc (Zn)',
            subtitle: 'Crucial for enzymes, immune function, and hoof/skin integrity.',
            chartData: {
                labels: ['Deficient', 'Marginal', 'Adequate'],
                values: [7, 12, 18.5],
                unit: 'µmol/L (Serum)',
                ranges: ['< 7', '7 - 12', '12 - 18.5']
            },
            details: [
                { title: 'Key NZ Context & Challenge', content: 'Supplementation is routine. High-dose zinc is used for facial eczema prevention in autumn, which requires careful management to avoid inducing a secondary copper deficiency.' },
                { title: 'Physiological Functions', content: 'Component of hundreds of enzymes. Essential for immune function, protein synthesis, and maintaining the integrity of epithelial barriers like skin and hooves.' },
                { title: 'Deficiency & Toxicity', content: '<b>Deficiency:</b> Reduced feed intake, parakeratosis (thick, crusty skin), poor hoof quality, and impaired immune function. <br><b>Toxicity:</b> Relatively non-toxic, but very high levels can induce copper deficiency.' }
            ]
        },
        copper: {
            title: 'Copper (Cu)',
            subtitle: 'For growth, immunity, and fertility. Status assessed by liver biopsy.',
            chartData: {
                labels: ['Deficient', 'Marginal', 'Adequate', 'Toxicity Risk'],
                values: [0.045, 0.095, 2.8, 3.0],
                unit: 'mmol/kg (Liver)',
                ranges: ['< 0.045', '0.045 - 0.095', '> 0.095', '> 2.800']
            },
            details: [
                { title: 'Key NZ Context & Challenge', content: 'Both deficiency (due to potent antagonism from Mo, S, and Fe) and chronic toxicity (from over-supplementation) are major concerns. Liver biopsy is the gold standard for assessment, as blood levels are a poor indicator of status.' },
                { title: 'Physiological Functions', content: 'Cofactor for enzymes involved in iron metabolism, connective tissue formation, pigmentation, and antioxidant defense. Vital for robust immune function.' },
                { title: 'Deficiency & Toxicity', content: '<b>Deficiency:</b> Poor growth, scours, reduced fertility, and loss of coat color ("spectacles"). <br><b>Toxicity:</b> Chronic toxicity is a growing problem. Excess Cu accumulates in the liver and a stress event can trigger a fatal hemolytic crisis.' }
            ]
        },
        selenium: {
            title: 'Selenium (Se)',
            subtitle: 'Key antioxidant and immune function modulator.',
            chartData: {
                labels: ['Deficient', 'Marginal', 'Adequate', 'Excessive'],
                values: [130, 250, 3000, 3200],
                unit: 'nmol/L (Whole Blood)',
                ranges: ['< 130', '130 - 250', '> 250', '> 3000']
            },
            details: [
                { title: 'Key NZ Context & Challenge', content: 'Many NZ soils are Se-deficient, making supplementation a routine necessity. Whole blood selenium is the preferred test for long-term status.' },
                { title: 'Physiological Functions', content: 'Functions via selenoproteins, most notably the antioxidant enzyme glutathione peroxidase (GPx). Essential for immune function (reducing retained membranes, mastitis) and thyroid hormone activation.' },
                { title: 'Deficiency & Toxicity', content: '<b>Deficiency:</b> White muscle disease in calves, retained fetal membranes, increased mastitis, and ill-thrift. <br><b>Toxicity:</b> Has a narrow margin of safety. Chronic toxicity causes hair loss and hoof deformities.' }
            ]
        },
        cobalt: {
            title: 'Cobalt (Co)',
            subtitle: 'Required by rumen microbes to synthesize Vitamin B12.',
            chartData: {
                labels: ['Deficient', 'Marginal', 'Adequate'],
                values: [75, 220, 250],
                unit: 'pmol/L (Serum B12)',
                ranges: ['< 75', '75 - 220', '> 220']
            },
            details: [
                { title: 'Key NZ Context & Challenge', content: 'Cobalt deficiency ("bush sickness") is common in many NZ regions. A cobalt deficiency is functionally a Vitamin B12 deficiency, so status is monitored by measuring serum B12.' },
                { title: 'Physiological Functions', content: 'Sole function is as a core component of Vitamin B12, which is synthesized by rumen microbes. B12 is essential for energy production (gluconeogenesis) and methionine metabolism.' },
                { title: 'Deficiency & Toxicity', content: '<b>Deficiency:</b> Loss of appetite, ill-thrift, poor growth, severe weight loss, and anemia. Young, growing animals are most susceptible. <br><b>Toxicity:</b> Not a practical concern.' }
            ]
        },
        iodine: {
            title: 'Iodine (I)',
            subtitle: 'Essential for thyroid hormones and metabolic rate.',
            chartData: {
                labels: ['Deficient', 'Marginal', 'Adequate'],
                values: [20, 35, 80],
                unit: 'nmol/L (Serum T4)',
                ranges: ['< 20', '20 - 35', '> 35']
            },
            details: [
                { title: 'Key NZ Context & Challenge', content: 'NZ forages are often low in iodine. The widespread use of goitrogenic brassica crops for winter feed increases the dietary requirement by interfering with iodine uptake by the thyroid gland.' },
                { title: 'Physiological Functions', content: 'An essential constituent of the thyroid hormones T4 and T3, which regulate the body\'s overall metabolic rate, growth, and reproduction.' },
                { title: 'Deficiency & Toxicity', content: '<b>Deficiency:</b> Goiter (enlarged thyroid), especially in newborn calves. In adults, causes reduced fertility and poor production. <br><b>Toxicity:</b> Narrow safety margin. Excess can cause coughing, nasal discharge, and paradoxically, goiter.' }
            ]
        }
    },
    vitamins: {
        vitaminA: {
            title: 'Vitamin A (Retinol)',
            subtitle: 'For vision, epithelial health, and immunity.',
            chartData: {
                labels: ['Deficient', 'Marginal', 'Adequate'],
                values: [0.2, 0.3, 0.4],
                unit: 'µg/mL (Plasma)',
                ranges: ['< 0.2', '0.2 - 0.3', '> 0.3']
            },
            details: [
                { title: 'Key NZ Context & Challenge', content: 'Sourced as beta-carotene from green forages. Supplementation is critical when feeding stored forages (silage, hay) or high-concentrate diets, as Vitamin A content degrades over time.' },
                { title: 'Physiological Functions', content: 'Essential for vision, maintaining the integrity of epithelial tissues (respiratory, GI, reproductive tracts), immune function, and reproduction.' },
                { title: 'Deficiency', content: 'Night blindness, reproductive failure, and increased susceptibility to infections due to compromised epithelial barriers.' }
            ]
        },
        vitaminD: {
            title: 'Vitamin D',
            subtitle: 'For calcium balance and immune modulation.',
            chartData: {
                labels: ['Suboptimal', 'Sufficient'],
                values: [30, 40],
                unit: 'ng/mL (Plasma 25-OH-D)',
                ranges: ['< 30', '> 30']
            },
            details: [
                { title: 'Key NZ Context & Challenge', content: 'Cows get Vitamin D from sunlight and sun-cured forages. Supplementation may be beneficial to optimize immune function, especially for cows with limited sun exposure during winter.' },
                { title: 'Physiological Functions', content: 'Regulates calcium and phosphorus homeostasis by promoting intestinal absorption. It also plays a critical, newly understood role in modulating the immune system.' },
                { title: 'Deficiency', content: 'Severe deficiency causes rickets (young) or osteomalacia (adults). Suboptimal status is linked to impaired immune function.' }
            ]
        },
        vitaminE: {
            title: 'Vitamin E (α-Tocopherol)',
            subtitle: 'The primary lipid-soluble antioxidant.',
            chartData: {
                labels: ['Deficient', 'Marginal', 'Adequate'],
                values: [2.0, 3.0, 4.0],
                unit: 'µg/mL (Plasma)',
                ranges: ['< 2.0', '2.0 - 3.0', '> 3.0']
            },
            details: [
                { title: 'Key NZ Context & Challenge', content: 'Abundant in fresh green pasture but degrades quickly in stored forages. Strategic high-dose supplementation in the pre-fresh (dry) period is an evidence-based strategy to boost immunity and reduce metabolic diseases.' },
                { title: 'Physiological Functions', content: 'Protects cell membranes from oxidative damage. It works synergistically with Selenium. This antioxidant role is crucial for immune cells, muscle, and the reproductive system.' },
                { title: 'Deficiency', content: 'Can cause white muscle disease (nutritional muscular dystrophy), especially if Selenium is also low. Suboptimal levels compromise immune function during the high-stress transition period.' }
            ]
        }
    }
};

let currentChart = null;

document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    const nutrientButtonsContainer = document.getElementById('nutrient-buttons');
    const nutrientDisplay = document.getElementById('nutrient-display');
    const nutrientPlaceholder = document.getElementById('nutrient-placeholder');

    function showTab(tabId) {
        tabContents.forEach(content => {
            if (content.id === `${tabId}-content` || (tabId !== 'overview' && content.id === 'nutrient-content-area')) {
                content.classList.remove('hidden');
            } else {
                content.classList.add('hidden');
            }
        });

        tabs.forEach(tab => {
            if (tab.dataset.tab === tabId) {
                tab.classList.add('tab-active');
            } else {
                tab.classList.remove('tab-active');
            }
        });
        
        nutrientDisplay.classList.add('hidden');
        nutrientPlaceholder.classList.remove('hidden');
        updateNutrientButtons(tabId);
    }
    
    function updateNutrientButtons(tabId) {
        nutrientButtonsContainer.innerHTML = '';
        if (tabId === 'overview') return;

        const nutrientCategory = nutrientData[tabId];
        Object.keys(nutrientCategory).forEach(key => {
            const nutrient = nutrientCategory[key];
            const button = document.createElement('button');
            button.className = 'nutrient-btn px-4 py-2 text-sm font-medium rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors';
            button.textContent = nutrient.title;
            button.dataset.nutrientKey = key;
            button.dataset.category = tabId;
            nutrientButtonsContainer.appendChild(button);
        });
    }

    tabs.forEach(tab => {
        tab.addEventListener('click', () => showTab(tab.dataset.tab));
    });

    nutrientButtonsContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('nutrient-btn')) {
            const key = e.target.dataset.nutrientKey;
            const category = e.target.dataset.category;
            displayNutrient(category, key);

            document.querySelectorAll('.nutrient-btn').forEach(btn => btn.classList.remove('nutrient-btn-active'));
            e.target.classList.add('nutrient-btn-active');
        }
    });

    function displayNutrient(category, key) {
        const nutrient = nutrientData[category][key];
        if (!nutrient) return;

        nutrientPlaceholder.classList.add('hidden');
        nutrientDisplay.classList.remove('hidden');

        document.getElementById('nutrient-title').textContent = nutrient.title;
        document.getElementById('nutrient-subtitle').textContent = nutrient.subtitle;

        const detailsContainer = document.getElementById('nutrient-details');
        detailsContainer.innerHTML = '';
        nutrient.details.forEach(detail => {
            const detailElement = document.createElement('details');
            detailElement.className = 'bg-gray-50 rounded-lg border border-gray-200';
            detailElement.innerHTML = `
                <summary class="flex justify-between items-center p-4 font-semibold text-gray-700">
                    <span>${detail.title}</span>
                    <span class="arrow-down">
                        <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </span>
                </summary>
                <div class="p-4 pt-0 text-gray-600">
                    ${detail.content}
                </div>
            `;
            detailsContainer.appendChild(detailElement);
        });

        renderChart(nutrient.chartData);
    }

    function renderChart(chartData) {
        const ctx = document.getElementById('nutrientChart').getContext('2d');
        const colors = {
            deficient: 'rgba(239, 68, 68, 0.7)', // red
            marginal: 'rgba(245, 158, 11, 0.7)', // amber
            adequate: 'rgba(16, 185, 129, 0.7)', // emerald
            excessive: 'rgba(147, 51, 234, 0.7)', // purple
            toxicity: 'rgba(127, 29, 29, 0.7)' // dark red
        };
        
        const backgroundColors = chartData.labels.map(label => {
            if (label.toLowerCase().includes('deficient')) return colors.deficient;
            if (label.toLowerCase().includes('marginal')) return colors.marginal;
            if (label.toLowerCase().includes('adequate') || label.toLowerCase().includes('sufficient')) return colors.adequate;
            if (label.toLowerCase().includes('excessive')) return colors.excessive;
            if (label.toLowerCase().includes('toxicity')) return colors.toxicity;
            return 'rgba(156, 163, 175, 0.7)';
        });
        
        if (currentChart) {
            currentChart.destroy();
        }

        currentChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: chartData.labels,
                datasets: [{
                    label: `Reference Range (${chartData.unit})`,
                    data: chartData.values,
                    backgroundColor: backgroundColors,
                    borderColor: backgroundColors.map(c => c.replace('0.7', '1')),
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: `Concentration (${chartData.unit})`,
                            font: { size: 14 }
                        }
                    },
                    y: {
                        ticks: {
                            font: { size: 12 }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const range = chartData.ranges[context.dataIndex];
                                return `Status: ${context.label} | Range: ${range} ${chartData.unit}`;
                            }
                        }
                    }
                }
            }
        });
    }

    showTab('overview');
});
</script>

</body>
</html>
